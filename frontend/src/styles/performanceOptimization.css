/* Performance optimizations for theme switching - DROPDOWN OVERLAP FIXED */

/* ===== CRITICAL DROPDOWN FIXES ===== */
/* Modified CSS containment to not block dropdowns */
.card {
  contain: style !important; /* Only style containment, not layout */
}

.modal {
  contain: style !important; /* Only style containment, not layout */
}

.navbar-custom,
.footer {
  contain: none !important; /* Remove containment that blocks dropdowns */
}

/* Optimize transitions for better performance */
@media (prefers-reduced-motion: no-preference) {
  * {
    transition-property: background-color, border-color, color, box-shadow,
      transform;
    transition-timing-function: ease;
    transition-duration: 0.3s;
  }

  /* Faster transitions for interactive elements */
  .btn,
  .nav-link,
  .form-control:focus {
    transition-duration: 0.2s;
  }

  /* Slower transitions for layout changes */
  .card,
  .modal-content {
    transition-duration: 0.4s;
  }
}

/* GPU acceleration for smooth transitions - MODIFIED FOR DROPDOWN COMPATIBILITY */
.card,
.btn {
  will-change: auto !important; /* Remove will-change that creates stacking contexts */
}

.navbar-custom,
.modal-content {
  will-change: auto !important; /* Remove will-change that creates stacking contexts */
}

/* Remove will-change after animations complete */
.transition-complete {
  will-change: auto;
}

/* Reduce reflows during theme changes - FIXED FOR DROPDOWNS */
.main-content,
.container {
  contain: none !important; /* Remove containment that blocks dropdowns */
}

/* Optimize expensive operations - MODIFIED FOR DROPDOWN COMPATIBILITY */
.navbar-custom::before,
footer::before {
  will-change: auto !important; /* Remove will-change that creates stacking contexts */
}

/* Batch DOM updates for theme changes */
.theme-switching {
  pointer-events: none;
}

.theme-switching * {
  transition-delay: 0s !important;
}

/* Optimize shadow rendering - MODIFIED FOR DROPDOWN COMPATIBILITY */
.card,
.modal-content {
  transform: none !important; /* Remove transform that creates stacking contexts */
}

.dropdown-menu {
  transform: translateZ(
    0
  ) !important; /* Only force GPU for dropdowns when needed */
  z-index: 1070 !important; /* Ensure dropdowns appear above content */
  contain: none !important; /* Remove containment that blocks positioning */
}

/* Memory optimization */
@media (max-width: 768px) {
  /* Reduce animations on mobile for better performance */
  .card:hover {
    transform: translateY(
      -1px
    ) !important; /* Minimal transform to avoid stacking issues */
  }

  .btn:hover {
    transform: none;
  }

  /* Simpler shadows on mobile */
  .card,
  .modal-content {
    box-shadow: 0 2px 8px var(--nexus-shadow);
  }
}

/* Optimize background gradients */
.navbar-custom,
footer {
  background-attachment: fixed;
}

@media (max-width: 768px) {
  /* Remove fixed backgrounds on mobile */
  .navbar-custom,
  footer {
    background-attachment: scroll;
  }
}

/* Critical rendering path optimization - MODIFIED FOR DROPDOWN COMPATIBILITY */
.above-fold {
  contain: style !important; /* Only style containment, not layout or paint */
}

/* Optimize font loading */
.brand-text,
.nav-link-custom {
  font-display: swap;
}

/* Reduce paint area during animations - FIXED FOR DROPDOWN COMPATIBILITY */
.navbar-custom,
.footer {
  isolation: auto !important; /* Remove isolation that blocks dropdowns */
}

/* Optimize expensive CSS operations */
.blur-effect {
  filter: blur(0); /* Prepare for GPU */
  transition: filter 0.3s ease;
}

.blur-effect.active {
  filter: blur(5px);
}

/* Batch CSS custom property updates */
:root {
  /* Group all color properties for atomic updates */
  --theme-transition-duration: 0.3s;

  /* CRITICAL: Override Bootstrap z-index for dropdown compatibility */
  --bs-zindex-dropdown: 1070 !important;
  --bs-zindex-sticky: 1065 !important;
  --bs-zindex-modal: 1080 !important;
  --bs-zindex-modal-backdrop: 1075 !important;
}

/* Performance monitoring hooks - FIXED FOR DROPDOWN COMPATIBILITY */
.perf-monitor {
  /* Use for performance tracking elements */
  contain: style !important; /* Only style containment */
}

/* Optimize for high refresh rate displays */
@media (min-resolution: 120dpi) {
  * {
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
    animation: none !important;
  }

  /* But keep essential feedback */
  .btn:focus,
  .form-control:focus {
    transition: box-shadow 0.1s ease !important;
  }
}

/* Optimize for dark mode performance */
[data-bs-theme="dark"] {
  /* Use simpler backgrounds in dark mode if needed */
  color-scheme: dark;
}

[data-bs-theme="light"] {
  color-scheme: light;
}

/* Layer management for better compositing - FIXED FOR DROPDOWN COMPATIBILITY */
.navbar-custom {
  z-index: 1060 !important; /* Explicit z-index for navbar */
  position: sticky !important; /* Change from relative to sticky */
  isolation: auto !important; /* Remove isolation that blocks dropdowns */
}

.modal {
  z-index: 1080 !important; /* Explicit z-index for modals */
  position: fixed;
  isolation: auto !important;
}

.dropdown-menu {
  z-index: 1070 !important; /* Explicit z-index for dropdowns */
  position: absolute !important;
  isolation: auto !important; /* Remove isolation that blocks positioning */
}

/* Optimize scrolling performance */
.main-content {
  scroll-behavior: smooth;
  overflow-anchor: none; /* Prevent scroll anchoring issues */
}

/* Critical resource hints */
.preload-theme {
  /* Use for preloading theme assets */
  content-visibility: hidden;
}

/* Optimize image rendering during theme changes */
img {
  transition: filter 0.3s ease;
}

[data-bs-theme="dark"] img:not(.preserve-colors) {
  filter: brightness(0.9);
}

/* ===== ADDITIONAL DROPDOWN COMPATIBILITY FIXES ===== */

/* Ensure navbar dropdowns work properly */
.navbar-custom .dropdown-menu {
  z-index: 1075 !important; /* Higher than navbar */
  top: calc(100% + 0.25rem) !important;
  margin-top: 0 !important;
}

/* Ensure user and notification dropdowns position correctly */
.navbar-custom .notification-btn + .dropdown-menu,
.navbar-custom .user-dropdown .dropdown-menu {
  right: 0 !important;
  left: auto !important;
}

/* Container fixes */
.container,
.container-fluid,
.App {
  contain: none !important; /* Remove all containment that could block dropdowns */
  isolation: auto !important;
  position: static;
  z-index: auto;
}

/* Toast positioning to avoid dropdown conflicts */
.toast-container {
  z-index: 1065 !important; /* Between navbar and dropdowns */
}

/* Modal backdrop positioning */
.modal-backdrop {
  z-index: 1075 !important; /* Between dropdowns and modals */
}
